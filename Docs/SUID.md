# SUID & SGID — זיהוי, סיכונים והמלצות

> **הערה אתית:** כל הפעולות המתוארות כאן הן **לשימוש חוקי בלבד** — מעבדות, CTFים מורשים ואודיטים. אין להשתמש בטיפים אלה כנגד מערכות ללא אישור מפורש.

---

## זיהוי קבצים עם SUID/SGID

כדי למפות קבצים שבהם ה־SUID/SGID מאופשר:

```bash
find / -type f -perm -04000 -ls 2>/dev/null
```

* `-04000` בודק את הביט SUID. אם רוצים SUID או SGID, אפשר להשתמש ב־`-perm /6000` או להריץ לבד נפרד.
* הפקודה מחזירה רשימה של בינאריים שניתן לבדוק לעומק.

### האם הבינארי חשוד? שימוש ב‑GTFOBins

* אתר שימושי: **GTFOBins** — [https://gtfobins.github.io/](https://gtfobins.github.io/).
* באתר יש כפתור **SUID** שמסנן בינאריים ידועים שניתנים לניצול כאשר להם יש SUID.
* מומלץ להשוות את הרשימה שמחזיר ה־`find` מול הפריטים ב‑GTFOBins (או להשתמש בקישור הממוין מראש: [https://gtfobins.github.io/#+suid](https://gtfobins.github.io/#+suid)).

---

## דוגמה מעשית — nano עם SUID

נניח שגילית ש־`nano` מופעל עם SUID (זהו תרחיש תיאורטי; במערכות עדכניות זה פחות סביר):

* כאשר קובץ טקסט עורך `nano` מופעל כ־root (EUID=root), הוא יכול לפתוח קבצים שמוגבלים לקריאה על־ידי root בלבד.
* כך, להריץ `nano /etc/shadow` יכולה להדפיס או לחשוף את תוכן `/etc/shadow` — קובץ זה מכיל את ה־hashes של סיסמאות המשתמשים (לא את הסיסמאות בעצמן).

**חשיבות:** גישה ל־`/etc/shadow` מאפשרת לבצע ניתוח-אוף-ליין של ההאשים (hashes) כדי לנסות לשחזר סיסמאות — פעולה שנכנסת לתחום שבין חידון אבטחה לשחיתות, ותתבצע רק בסביבה מורשה.

---

## unshadow ו־John the Ripper — מה בקצרה

* הקבצים `/etc/passwd` ו־`/etc/shadow` מכילים יחד את המידע הדרוש ליצירת קובץ שמשמש כלים לשבירת hashים (כמו John the Ripper). כלי בשם `unshadow` מקבץ את המידע לקובץ אחד שניתן להזין לכלי שבירה.
* **אני לא אספק כאן הוראות מלאות לשבירת סיסמאות**, מכיוון שזה עלול לשמש לפגיעה במערכות. אם המטרה היא למידה — בצע זאת רק בסביבת מעבדה עם חשבונות מדומים.

---

## סימני זיהוי ומה לבדוק

* לאחר הרצת `find` בדוק את הבינארי בעזרת `stat`/`ls -l` כדי לוודא בעלות והרשאות:

  ```bash
  ls -l /path/to/binary
  stat /path/to/binary
  ```
* השתמש ב־`strings` ו־`ltrace/strace` (במעבדה) כדי לראות האם הבינארי קורא לפקודות חיצוניות (יש כאן סיכון PATH hijack).
* בדוק אם יש קבצים ניתנים לכתיבה בספריות הקריטיות (Writable dirs), כי זה מאפשר השתלה:

  ```bash
  find / -writable 2>/dev/null | cut -d"/" -f2,3 | grep -v proc | sort -u
  ```

---

## המלצות למניעה ותיקון

* **הסר SUID מבינאריים מיותרים:**

  ```bash
  chmod u-s /path/to/binary
  ```
* **הגבל הרשאות כתיבה בספריות ציבוריות** (אל תאפשר ל־/tmp או תיקיות ששותפות לכתיבה לצבור בינאריים קריטיים).
* **השתמש בנתיבים מוחלטים ובניקוי PATH** בתכניות שרצות בפריבילגיות גבוהות.
* **בדוק קונפיגורציות NFS** כך שלא ניתן למפות תיקיות נכתבות שמכילות בינאריים רגישים.
* **הרץ סריקות תקופתיות** ל־SUID/SGID והשתמש ב־auditing (auditd) לזיהוי הרצות חשודות.

---

## כיצד להמשיך בלמידה באופן בטוח

* תרגל במעבדה ואל תבצע בשום מערכת שאינה בבעלותך או ללא אישור מפורש.
* אם תרצה, אוכל להכין עבורך תרגול מעבדה (קבצים מדומים/VM) שמדגים את התהליך בצורה בטוחה — כולל דוגמת `find`, איתור `nano` עם SUID, יצירת קובץ shadow מדומה ושימוש בכלים לניתוח מבלי להכיל הוראות לשבירה בפועל.

---

**סוף — SUID.md**
